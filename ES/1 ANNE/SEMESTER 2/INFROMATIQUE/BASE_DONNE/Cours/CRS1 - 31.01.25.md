# Connection


```bash title:"Connection Postgresql SSH"
psql -h 192.168.136.131 -p 5432 -U postgres postgres
```

```bash title:"Connection Postgresql TestUser"
psql -h localhost -p 5432 -U testuser -W testdb

psql -h 192.168.136.131 -p 5432 -U testuser -W testdb
```

``` bash title:"Connection Debian SSH"
ssh debian@192.168.136.131
```

MDP : 
- Postgres :  p0stgr3s
- Ubuntu Local : Skyjo@@sFull2024
- debian : debianpass

# Th√©orie
Cluster => Plusieurs bases de donn√©es g√©r√©es par un service

TABLESPACE => un emplacement abstrait

# Configuration de PostgreSQL, D√©finition MDP Postgres

#### 1. Installation de PostgreSQL

```bash
# Installer PostgreSQL via apt
sudo apt-get install postgresql
```

---

#### 2. D√©finir le mot de passe de l'utilisateur `postgres`
```bash
# Devenir l'utilisateur "postgres"
sudo su postgres [-p 5433] #Si il y plusieurs clusters

# Lancer l'interface PSQL
psql

# Changer le mot de passe dans PSQL
\password postgres  # Entrez et confirmez le mot de passe (ex: p0stgr3s)
\q                  # Quitter PSQL
exit                # Quitter l'utilisateur "postgres"
```

---

#### 3. Gestion du cluster PostgreSQL
### Afficher l'√©tat du service
```bash
sudo systemctl status postgresql
```

### Red√©marrer le service
```bash
sudo systemctl stop postgresql    # Arr√™ter
sudo systemctl start postgresql   # D√©marrer
```

---

#### 4. Configuration pour l'acc√®s distant
##### Modifier `postgresql.conf`
```bash
# Ouvrir le fichier (remplacez x.y par votre version, ex: 14/main)
sudo nano /etc/postgresql/x.y/main/postgresql.conf

# Modifier les param√®tres :
listen_addresses = '*'  # √âcoute sur toutes les interfaces
port = 5432             # Port par d√©faut
```

##### Modifier `pg_hba.conf` (autorisations)
```bash
sudo nano /etc/postgresql/x.y/main/pg_hba.conf

# Ajouter ces r√®gles :
host    all             all             127.0.0.1/32            md5  # Local
host    all             all             0.0.0.0/0               md5  # Toutes les IP
```

##### Appliquer les changements
```bash
sudo systemctl restart postgresql
```

---

#### 5. Tester la connexion distante
```bash
# Depuis une autre machine :
psql -h <IP_DU_SERVEUR_POSTGRESQL> -p 5432 -U postgres -d postgres
# Entrez le mot de passe lorsque demand√©
```

---

## üîê Notes importantes
- **S√©curit√©** : 
  - √âvitez `0.0.0.0/0` en production. Utilisez un sous-r√©seau sp√©cifique (ex: `192.168.1.0/24`).
- **Version** : 
  - V√©rifiez votre version avec `psql --version` et adaptez les chemins (`x.y`).


# Cr√©ation BD Test avec Utilisateur Testuser

---

#### 1. Connexion au serveur PostgreSQL

```bash
psql -h <serveur> -p 5432 -U postgres -W
```

Entrez le mot de passe lorsque demand√©.

---

#### 2. Liste des bases de donn√©es disponibles

Dans PostgreSQL :

```sql
\l
```

---

#### 3. Cr√©ation d‚Äôun r√¥le utilisateur

Commande :

```sql
CREATE ROLE testuser LOGIN PASSWORD 'testuser';
```

Pour visualiser la liste des r√¥les :

```sql
\du+
```

---

#### 4. Cr√©ation d‚Äôune base de donn√©es

Commande :

```sql
CREATE DATABASE testdb WITH OWNER testuser;
```

Pour v√©rifier la cr√©ation de la base de donn√©es :

```sql
\l
```

---

#### 5. Connexion avec l‚Äôutilisateur nouvellement cr√©√©

Dans le terminal :

```bash
psql -h localhost -p 5432 -U testuser -W testdb
```

---

#### 6. Cr√©ation d‚Äôune table

Commande :

```sql
CREATE TABLE testtable (colonne INTEGER);
```

Pour afficher la liste des tables :

```sql
\dt+
```

---

#### 7. Insertion de donn√©es dans la table

Commande :

```sql
INSERT INTO testtable (colonne) VALUES (111);
```

V√©rification :

```sql
SELECT * FROM testtable;
```

---

#### 8. Modification de donn√©es dans la table

Commande :

```sql
UPDATE testtable SET colonne = 222;
```

V√©rification :

```sql
SELECT * FROM testtable;
```

---

#### 9. Suppression de donn√©es

Commande :

```sql
DELETE FROM testtable;
```

V√©rification :

```sql
SELECT * FROM testtable;
```

---

#### 10. Suppression de la table

Commande :

```sql
DROP TABLE testtable;
```

V√©rification :

```sql
\dt
```

---

#### 11. Ex√©cution d‚Äôun script SQL

Si vous avez un script nomm√© `test.sql`, ex√©cutez le avec :

```sql
\i ./test.sql
```

# Ex√©cution des scripts et sql

```bash title:"Permission Denieded"
zeinalovd@LAPTOP-CI21CTOA:~/intbasdb.schema-magasin-master/scripts$ ./createSchema.sh
-bash: ./createSchema.sh: Permission denied

zeinalovd@LAPTOP-CI21CTOA:~/intbasdb.schema-magasin-master/scripts$ chmod +x createSchema.sh
```

```bash title:Create Base from ubuntu local

```



# Erreurs rencontr√©

```bash title:"Machine qui tourne dans le vide apr√©s le mdp"
zeinalovd@LAPTOP-CI21CTOA:~/intbasdb.schema-magasin-master/scripts$ psql -h 192.162.136.131 -p 5432 -U magasin magasindb -W
Password:
```

```bash :
```